(()=>{"use strict";browser.runtime.onMessage.addListener(((e,t,r)=>{if(e)switch(e.method){case"startTranslateSelection":{const e=window.getSelection().getRangeAt(0).getBoundingClientRect(),t=e.left+window.scrollX,n=e.bottom+window.scrollY+30,s=function(){const e="translate-popover",t=document.getElementById(e);if(t)return t.getPosition()}(),o=function(e){const t="translate-popover";{const e=document.getElementById(t);e&&e.remove()}document.body.insertAdjacentHTML("beforeend",`<translate-popover id="${t}"></translate-popover>`);const r=document.getElementById(t);r.setAttribute("position",JSON.stringify(e));const n=e=>{e.target.closest(t)||(r.remove(),document.removeEventListener("click",n))};return document.addEventListener("click",n),r.addEventListener("close",(()=>{r.remove(),document.removeEventListener("click",n)})),r.addEventListener("change",(async e=>{if(e.detail){try{await browser.storage.local.set({selectedSourceLanguage:void 0,selectedTargetLanguage:e.detail.selectedTargetLanguage})}catch(e){r.setAttribute("error",e.message)}browser.runtime.sendMessage({method:"translateSelection",selectionText:void 0})}})),r}(s||{x:t,y:n});o.setAttribute("loading",!0),r();break}case"finishTranslateSelection":{const t=e.result,n=document.getElementById("translate-popover");if(n){if(t.result&&t.result.texts){const r=t.result.texts.map((e=>e.text)).join("\n");n.setAttribute("result",`${r}`),n.setAttribute("lang",`${e.targetLanguage||""}`)}else if(t.error){const e=browser.i18n.getMessage("error_message_generic_error");n.setAttribute("error",e)}else{const e=browser.i18n.getMessage("error_message_generic_error");n.setAttribute("error",e)}n.setAttribute("loading",!1)}r();break}}}))})();
//# sourceMappingURL=translate_selection.js.map