(()=>{"use strict";const e=[{code:"BG",name:"Bulgarian"},{code:"ZH",name:"Chinese (simplified)"},{code:"CS",name:"Czech"},{code:"DA",name:"Danish"},{code:"NL",name:"Dutch"},{code:"EN",name:"English"},{code:"ET",name:"Estonian"},{code:"FI",name:"Finnish"},{code:"FR",name:"French"},{code:"DE",name:"German"},{code:"EL",name:"Greek"},{code:"HU",name:"Hungarian"},{code:"ID",name:"Indonesian"},{code:"IT",name:"Italian"},{code:"JA",name:"Japanese"},{code:"KO",name:"Korean"},{code:"LV",name:"Latvian"},{code:"LT",name:"Lithuanian"},{code:"NB",name:"Norwegian"},{code:"PL",name:"Polish"},{code:"PT",name:"Portuguese"},{code:"RO",name:"Romanian"},{code:"RU",name:"Russian"},{code:"SK",name:"Slovak"},{code:"SL",name:"Slovenian"},{code:"ES",name:"Spanish"},{code:"SV",name:"Swedish"},{code:"TR",name:"Turkish"},{code:"UK",name:"Ukrainian"}];class t{#e=1e4*Math.round(1e4*Math.random());#t;#n;constructor(){}setSourceLanguage(e){this.#t=e}setTargetLanguage(e){this.#n=e}async translate(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.#e++;let a=1;for(const e of t)for(let t=0;t<e.length;t++)"i"===e[t]&&a++;let s=Date.now();s=s-s%a+a;let o=JSON.stringify({jsonrpc:"2.0",method:"LMT_handle_texts",params:{texts:t.map((e=>({text:e}))),html:n?"enabled":void 0,splitting:n?void 0:"newlines",lang:{target_lang:(i=this.#n,e.some((e=>e.code===i))?this.#n:e[0].code),source_lang_user_selected:this.#t||"auto"},timestamp:s},id:this.#e});var i;o=o.replace('"method":"',""+((this.#e+3)%13==0||(this.#e+5)%29==0?'"method" : "':'"method": "'));const r={method:n?"translate":"translateSelection",payload:{headers:{Accept:"*/*","x-app-os-name":"iOS","Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Referer:"https://www.deepl.com/"},method:"POST",body:o}};return new Promise((e=>{browser.runtime.sendNativeMessage("application.id",r,(t=>{t&&t.result?e(t.result):e(void 0)}))}))}}async function n(e,n,a){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=new t;o.setSourceLanguage(n),o.setTargetLanguage(a);return await o.translate(e,s)}new class{#a=void 0;constructor(){this.#s()}#s(){this.#o(),this.#i()}#o(){browser.runtime.onMessage.addListener(((e,t,a)=>{if(e){switch(e.method){case"translate":n(e.texts,e.sourceLanguage,e.targetLanguage).then((e=>{a({result:e})})).catch((e=>{a()}));break;case"translateSelection":{const t=this.#a;e.selectionText&&e.selectionText.trim()?this.#r(e.selectionText):t&&t.trim()&&this.#r(t),a();break}default:a()}return!0}})),browser.commands.onCommand.addListener((e=>{"trigger-translation"===e&&browser.storage.local.get(["settingsReadingShortcut"],(e=>{(void 0===e.settingsReadingShortcut||e.settingsReadingShortcut)&&browser.tabs.executeScript({code:"window.getSelection().toString();"}).then((e=>{if(e){const t=e.toString().trim();t&&this.#r(t)}}))}))}))}#i(){browser.menus.create&&(browser.menus.create({id:"translateSelection",title:browser.i18n.getMessage("context_menus_translate_section"),contexts:["editable","link","page","selection"]}),browser.menus.onClicked.addListener((async(e,t)=>{if("translateSelection"===e.menuItemId){const t=e.selectionText;t&&t.trim()&&this.#r(t)}})))}async#r(e){this.#a=e;const t=await async function(){return new Promise(((e,t)=>{browser.storage.local.get(["selectedTargetLanguage"],(t=>{if(t&&t.selectedTargetLanguage)e(t.selectedTargetLanguage);else{const t=browser.i18n.getUILanguage().split("-").shift().toUpperCase();e(t)}}))}))}();browser.tabs.query({active:!0,currentWindow:!0},(t=>{browser.tabs.sendMessage(t[0].id,{method:"startTranslateSelection",selectionText:e})}));const a=await n([e],void 0,t,!1);browser.tabs.query({active:!0,currentWindow:!0},(e=>{browser.tabs.sendMessage(e[0].id,{method:"finishTranslateSelection",result:a,targetLanguage:t})})),browser.runtime.sendMessage({method:"finishTranslateSelection"})}}})();
//# sourceMappingURL=background.js.map