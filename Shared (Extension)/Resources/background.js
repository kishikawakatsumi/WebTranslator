(()=>{"use strict";function e(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function t(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,a(e,t,"get"))}function n(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,a(e,t,"set"),n),n}function a(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var s=new WeakMap,i=new WeakMap,r=new WeakMap;class o{constructor(){e(this,s,{writable:!0,value:1e4*Math.round(1e4*Math.random())}),e(this,i,{writable:!0,value:void 0}),e(this,r,{writable:!0,value:void 0})}setSourceLanguage(e){n(this,i,e)}setTargetLanguage(e){n(this,r,e)}async translate(e){var a;let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n(this,s,(a=t(this,s),a++,a));let l=1;for(const t of e)for(let e=0;e<t.length;e++)"i"===t[e]&&l++;let c=Date.now();c=c-c%l+l;let u=JSON.stringify({jsonrpc:"2.0",method:"LMT_handle_texts",params:{texts:e.map((e=>({text:e}))),html:o?"enabled":void 0,splitting:o?void 0:"newlines",lang:{target_lang:t(this,r),source_lang_user_selected:t(this,i)||"auto"},timestamp:c},id:t(this,s)});u=u.replace('"method":"',""+((t(this,s)+3)%13==0||(t(this,s)+5)%29==0?'"method" : "':'"method": "'));const h={method:o?"translate":"translateSelection",payload:{headers:{Accept:"*/*","x-app-os-name":"iOS","Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Referer:"https://www.deepl.com/"},method:"POST",body:u}};return new Promise((e=>{browser.runtime.sendNativeMessage("application.id",h,(t=>{t&&t.result?e(t.result):e(void 0)}))}))}}function l(e,t){u(e,t),t.add(e)}function c(e,t,n){u(e,t),t.set(e,n)}function u(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,d(e,t,"set"),n),n}function w(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,d(e,t,"get"))}function d(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function g(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var f=new WeakMap,p=new WeakMap,m=new WeakSet,b=new WeakSet,v=new WeakSet,T=new WeakSet,y=new WeakSet;function S(){g(this,b,x).call(this),g(this,v,k).call(this)}function x(){browser.runtime.onMessage.addListener(((e,t,n)=>{if(e){switch(e.method){case"translate":_(e.texts,e.sourceLanguage,e.targetLanguage).then((e=>{n({result:e})})).catch((e=>{n()}));break;case"translateSelection":{const t=w(this,p);e.selectionText&&e.selectionText.trim()?g(this,y,M).call(this,e.selectionText):t&&t.trim()&&g(this,y,M).call(this,t),n();break}default:n()}return!0}}))}function k(){browser.menus.create&&(browser.menus.create({id:"translateSelection",title:browser.i18n.getMessage("context_menus_translate_section"),contexts:["editable","link","page","selection"]}),browser.menus.onClicked.addListener((async(e,t)=>{if("translateSelection"===e.menuItemId){const t=e.selectionText;t&&t.trim()&&g(this,y,M).call(this,t)}})))}async function L(){const e=await browser.tabs.executeScript({code:'if (!window.customElements.get("translate-popover")) { true; }'});e&&e[0]&&(await browser.tabs.executeScript({file:"/translate_selection_popover.js"}),await browser.tabs.executeScript({file:"/translate_selection.js"}),h(this,f,!1)),w(this,f)&&(await browser.tabs.executeScript({file:"/translate_selection.js"}),h(this,f,!1))}async function M(e){g(this,T,L).call(this),h(this,p,e);const t=await async function(){return new Promise(((e,t)=>{browser.storage.local.get(["selectedTargetLanguage"],(t=>{if(t&&t.selectedTargetLanguage)e(t.selectedTargetLanguage);else{const t=browser.i18n.getUILanguage().split("-").shift().toUpperCase();e(t)}}))}))}();browser.tabs.query({active:!0,currentWindow:!0},(t=>{browser.tabs.sendMessage(t[0].id,{method:"startTranslateSelection",selectionText:e})}));const n=await _([e],void 0,t,!1);browser.tabs.query({active:!0,currentWindow:!0},(e=>{browser.tabs.sendMessage(e[0].id,{method:"finishTranslateSelection",result:n,targetLanguage:t})})),browser.runtime.sendMessage({method:"finishTranslateSelection"})}async function _(e,t,n){let a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=new o;s.setSourceLanguage(t),s.setTargetLanguage(n);const i=await s.translate(e,a);return i}new class{constructor(){l(this,y),l(this,T),l(this,v),l(this,b),l(this,m),c(this,f,{writable:!0,value:!0}),c(this,p,{writable:!0,value:void 0}),g(this,m,S).call(this)}}})();
//# sourceMappingURL=background.js.map