(()=>{"use strict";class e{#e=1e4*Math.round(1e4*Math.random());#t;#s;constructor(){}setSourceLanguage(e){this.#t=e}setTargetLanguage(e){this.#s=e}async translate(e){this.#e++;let t=1;for(const s of e)for(let e=0;e<s.length;e++)"i"===s[e]&&t++;let s=Date.now();s=s-s%t+t;let a=JSON.stringify({jsonrpc:"2.0",method:"LMT_handle_texts",params:{texts:e.map((e=>({text:e}))),html:"enabled",lang:{target_lang:this.#s,source_lang_user_selected:this.#t||"auto"},timestamp:s},id:this.#e});a=a.replace('"method":"',""+((this.#e+3)%13==0||(this.#e+5)%29==0?'"method" : "':'"method": "'));const r={method:"translate",payload:{headers:{Accept:"*/*","x-app-os-name":"iOS","Accept-Encoding":"gzip, deflate, br","Content-Type":"application/json",Referer:"https://www.deepl.com/"},method:"POST",body:a}};return new Promise((e=>{browser.runtime.sendNativeMessage("application.id",r,(t=>{e(t.result)}))}))}}new class{#a=void 0;constructor(){this.#r(),this.#i()}#r(){this.#n(),this.#o()}#n(){browser.runtime.onMessage.addListener((async(t,s,a)=>{if(t&&"translate"===t.method){const s=t.texts,r=await async function(t,s,a){const r=new e;r.setSourceLanguage(s),r.setTargetLanguage(a);return await r.translate(t)}(s,t.sourceLanguage,t.targetLanguage);a({result:r})}else t&&"getLoginSession"===t.method?a({result:this.#a}):a()}))}#o(){browser.alarms.create("getUserDisplayName",{periodInMinutes:60}),browser.alarms.onAlarm.addListener((e=>{"getUserDisplayName"===e.name&&this.#i()}))}#i(){browser.runtime.sendNativeMessage("application.id",{method:"getUserDisplayName"},(e=>{e&&e.result?this.#a=e.result:this.#a=void 0}))}}})();