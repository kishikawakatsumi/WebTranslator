(()=>{"use strict";function t(t){return new Promise((e=>{const s=new IntersectionObserver((([t])=>{e(1===t.intersectionRatio),s.disconnect()}));s.observe(t)}))}function e(t){const e=t.childNodes;return 0!==e.length&&(e[0].nodeType===Node.TEXT_NODE&&""!==e[0].nodeValue.trim())}function s(t){const e=t.children;if(!e||0===e.length)return!1;for(const t of e){const e=getComputedStyle(t).display;if("inline"===e||"inline-block"===e)return!0}}new class{#t=1;#e=void 0;#s=void 0;#n={};#i={};#a=!1;#r=!1;#o=!1;constructor(){this.#l()}#l(){this.#g()}#g(){browser.runtime.onMessage.addListener((async(t,e,s)=>{if(t&&"translate"===t.method)this.#r=!0,await this.#u(t),function(t,e){let s;return function(){return t&&(s=t.apply(e||this,arguments),t=void 0),s}}(function(t,e=200){if(!t||"function"!=typeof t)return;let s;window.addEventListener("scroll",(function(n){window.clearTimeout(s),s=setTimeout(t,e)}),!1)}((async()=>{const t=function(t,e=250){let s;return(...n)=>{clearTimeout(s),s=setTimeout((()=>{t(...n)}),e)}}((async()=>{await this.#u({sourceLanguage:this.#e,targetLanguage:this.#s})}),250);this.#r&&t()})))(),s();else if(t&&"getContentState"===t.method)this.#a?s({result:{isProcessing:this.#a}}):Object.keys(this.#n).length>0?s({result:{sourceLanguage:this.#e,targetLanguage:this.#s,isShowingOriginal:this.#o}}):s(void 0);else if(t&&"showOriginal"===t.method){this.#r=!1,this.#o=!0;const t=document.querySelectorAll('[data-wtdl-translated="true"]');for(const e of t){const t=e.dataset.wtdlUid,s=this.#n[t];e.innerHTML=s,e.dataset.wtdlTranslated="false"}s()}else s()}))}async#u(e){this.#c();const s=document.querySelectorAll('[data-wtdl-translated="false"]');if(this.#s===e.targetLanguage)for(const t of s){const e=t.dataset.wtdlUid,s=this.#i[e];t.innerHTML=s,t.dataset.wtdlTranslated="true"}const i=await async function(){const e=[];n(document.body.children,e);const s=[];for(const n of e){!await t(n)||void 0!==n.dataset.wtdlUid&&"false"!==n.dataset.wtdlTranslated||s.push({element:n,text:n.innerHTML})}return s}();if(i.length>0){const t=i.map((t=>t.text)),s=await browser.runtime.sendMessage({method:"translate",texts:t,sourceLanguage:e.sourceLanguage,targetLanguage:e.targetLanguage});if(s&&s.result){const t=s.result.result;if(t&&t.texts){this.#e=t.lang,this.#s=e.targetLanguage;const s=t.texts;if(s.length===i.length)for(let t=0;t<i.length;t++){const e=i[t].element,n=s[t].text,a=this.#t++;this.#n[a]=e.innerHTML,this.#i[a]=n,e.innerHTML=n,e.dataset.wtdlUid=`${a}`,e.dataset.wtdlOriginal="true",e.dataset.wtdlTranslated="true"}}}}this.#d()}#c(){this.#a=!0,this.#o=!1,browser.runtime.sendMessage({method:"startTranslation"})}#d(){this.#a=!1,browser.runtime.sendMessage({method:"finishTranslation",result:{sourceLanguage:this.#e,targetLanguage:this.#s}})}};function n(t,i){for(const a of t)if(e(a)||s(a))i.push(a);else{const t=a.children;if(!t||0===t.length)continue;n(a.children,i)}}})();