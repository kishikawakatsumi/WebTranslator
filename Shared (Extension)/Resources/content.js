(()=>{"use strict";function t(t){const e=t.getBoundingClientRect();return e.top<=window.innerHeight&&e.left<=window.innerWidth}function e(t){const e=t.childNodes;return 0!==e.length&&(e[0].nodeType===Node.TEXT_NODE&&""!==e[0].nodeValue.trim())}function n(t){const e=t.children;if(!e||0===e.length)return!1;for(const t of e){const e=getComputedStyle(t).display;if("inline"===e||"inline-block"===e)return!0}}function s(t,e){a(t,e),e.add(t)}function i(t,e,n){a(t,e),e.set(t,n)}function a(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function o(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,l(t,e,"get"))}function r(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,l(t,e,"set"),n),n}function l(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function c(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}var d=new WeakMap,u=new WeakMap,g=new WeakMap,h=new WeakMap,w=new WeakMap,m=new WeakMap,f=new WeakMap,v=new WeakMap,b=new WeakMap,p=new WeakMap,y=new WeakSet,T=new WeakSet,L=new WeakSet,S=new WeakSet,k=new WeakSet,M=new WeakSet,E=new WeakSet,W=new WeakSet,A=new WeakSet,_=new WeakSet,x=new WeakSet,B=new WeakSet,I=new WeakSet,O=new WeakSet,N=new WeakSet,H=new WeakSet;function C(){c(this,T,j).call(this);const t=document.getElementById("translate-popover");t&&t.remove();const e=document.getElementById("translate-button");e&&e.remove(),r(this,m,c(this,W,q).call(this)),r(this,f,c(this,A,D).call(this)),c(this,S,R).call(this),("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&c(this,k,P).call(this)}function j(){const t="__wtdl-global-data",e=document.getElementById(t);if(e){if(e.dataset.wtdlOriginalTexts)try{r(this,h,JSON.parse(e.dataset.wtdlOriginalTexts))}catch(t){}}else document.body.insertAdjacentHTML("beforeend",`<div id="${t}" style="display: none;"></div>`)}function $(){const t=document.getElementById("__wtdl-global-data");t&&(t.dataset.wtdlOriginalTexts=JSON.stringify(o(this,h)))}function R(){browser.runtime.onMessage.addListener((async(t,e,n)=>{if(t)switch(t.method){case"translate":r(this,b,!0),await c(this,B,z).call(this,t),function(t,e){let n;return function(){return t&&(n=t.apply(e||this,arguments),t=void 0),n}}(function(t){let e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;window.addEventListener("scroll",(function(s){window.clearTimeout(e),e=setTimeout(t,n)}),{once:!1,passive:!0,capture:!0})}((async()=>{o(this,b)&&await c(this,B,z).call(this,{sourceLanguage:o(this,u),targetLanguage:o(this,g)})}),500))(),n();break;case"getContentState":o(this,v)?n({result:{isProcessing:o(this,v)}}):Object.keys(o(this,h)).length>0?n({result:{sourceLanguage:o(this,u),targetLanguage:o(this,g),isShowingOriginal:o(this,p)}}):n(void 0);break;case"showOriginal":{r(this,b,!1),r(this,p,!0);const t=document.querySelectorAll('[data-wtdl-translated="true"]');for(const e of t){const t=e.dataset.wtdlUid,n=o(this,h)[t];void 0!==n&&(e.innerHTML=n,e.dataset.wtdlTranslated="false")}n();break}case"startTranslateSelection":{const t=window.getSelection().getRangeAt(0).getBoundingClientRect(),e=t.left+window.scrollX,s=t.bottom+window.scrollY+30,i=c(this,x,Y).call(this);c(this,_,X).call(this,i||{x:e,y:s}).setAttribute("loading",!0),n();break}case"finishTranslateSelection":{const e=t.result,s=document.getElementById("translate-popover");if(s){if(e.result&&e.result.texts){const n=e.result.texts.map((t=>t.text)).join("\n");s.setAttribute("result",`${n}`),s.setAttribute("lang",`${t.targetLanguage||""}`)}else if(e.error){const t=browser.i18n.getMessage("error_message_generic_error");s.setAttribute("error",t)}else{const t=browser.i18n.getMessage("error_message_generic_error");s.setAttribute("error",t)}s.setAttribute("loading",!1)}n();break}case"getSelection":{const t=window.getSelection();n({result:t?t.toString():void 0});break}default:n()}}))}function P(){document.addEventListener("pointerup",(async t=>{t.preventDefault();const e=window.getSelection(),n=e?e.toString().trim():"";n||e.rangeCount?setTimeout((()=>{const t=e.getRangeAt(0).cloneRange();t.collapse(e.anchorOffset>e.focusOffset);const s=t.getBoundingClientRect(),i=s.right+window.scrollX-20,a=s.bottom+window.scrollY+40;{const t=window.getSelection();if(!t||!t.toString().trim())return void c(this,E,J).call(this)}const o=c(this,M,U).call(this,{x:i,y:a});o.addEventListener("tooltipClick",(t=>{if(t.preventDefault(),t.stopPropagation(),n){const t={method:"translateSelection",selectionText:n};browser.runtime.sendMessage(t)}return o.remove(),!1}))}),100):c(this,E,J).call(this)}))}function U(t){const e="translate-button";{const t=document.getElementById(e);t&&t.remove()}document.body.insertAdjacentHTML("beforeend",`<translate-button id="${e}"></translate-button>`);const n=document.getElementById(e);return n.setAttribute("position",JSON.stringify(t)),document.addEventListener("touchstart",(t=>{t.target.closest(e)||n.remove()}),{once:!0}),n}function J(){const t=document.getElementById("translate-button");t&&t.remove()}function q(){const t="toast-progress",e=document.getElementById(t);return e&&e.remove(),document.body.insertAdjacentHTML("beforeend",`<toast-progress id="${t}"></toast-progress>`),document.getElementById(t)}function D(){const t="toast-error",e=document.getElementById(t);return e&&e.remove(),document.body.insertAdjacentHTML("beforeend",`<toast-error id="${t}"></toast-error>`),document.getElementById(t)}function X(t){const e="translate-popover";{const t=document.getElementById(e);t&&t.remove()}document.body.insertAdjacentHTML("beforeend",`<translate-popover id="${e}"></translate-popover>`);const n=document.getElementById(e);n.setAttribute("position",JSON.stringify(t));const s=t=>{t.target.closest(e)||(n.remove(),document.removeEventListener("click",s))};return document.addEventListener("click",s),n.addEventListener("close",(async()=>{n.remove(),document.removeEventListener("click",s)})),n.addEventListener("change",(async t=>{if(!t||!t.detail)return;await browser.storage.local.set({selectedSourceLanguage:void 0,selectedTargetLanguage:t.detail.selectedTargetLanguage});const e={method:"translateSelection",selectionText:void 0};browser.runtime.sendMessage(e)})),n}function Y(){const t=document.getElementById("translate-popover");if(t)return t.getPosition()}async function z(e){const n=document.querySelectorAll('[data-wtdl-translated="false"]');if(o(this,g)===e.targetLanguage)for(const t of n){const e=t.dataset.wtdlUid,n=o(this,w)[e];t.innerHTML=n,t.dataset.wtdlTranslated="true"}const s=await async function(){const e=[];Q(document.body.children,e);const n=[];for(const s of e){!t(s)||void 0!==s.dataset.wtdlUid&&"false"!==s.dataset.wtdlTranslated||n.push({element:s,text:s.innerHTML})}return n}();if(0===s.length)return void c(this,O,V).call(this);c(this,I,K).call(this);const i=s.map((t=>t.text)),a=await browser.runtime.sendMessage({method:"translate",texts:i,sourceLanguage:e.sourceLanguage,targetLanguage:e.targetLanguage});if(a&&a.result){const t=a.result.result;if(t&&t.texts){r(this,u,t.lang),r(this,g,e.targetLanguage);const n=t.texts;if(n.length===s.length){for(let t=0;t<s.length;t++){var l,m;const e=s[t].element,i=n[t].text,a=e.dataset.wtdlUid||(r(this,d,(l=o(this,d),m=l++,l)),m);"true"!==e.dataset.wtdlOriginal&&(o(this,h)[a]=e.innerHTML),o(this,w)[a]=i,e.innerHTML=i,e.dataset.wtdlUid=`${a}`,e.dataset.wtdlOriginal="true",e.dataset.wtdlTranslated="true"}c(this,L,$).call(this)}}else if(a.result.error){const t=1045601===a.result.error.code?browser.i18n.getMessage("error_message_quota_has_been_reached"):a.result.error.message||browser.i18n.getMessage("error_message_generic_error");return void c(this,N,F).call(this,t)}}c(this,H,G).call(this)}function K(){o(this,m).setAttribute("show",!0),r(this,v,!0),r(this,p,!1),browser.runtime.sendMessage({method:"startTranslation"})}function V(){r(this,p,!1),browser.runtime.sendMessage({method:"cancelTranslation",result:{sourceLanguage:o(this,u),targetLanguage:o(this,g)}})}function F(t){r(this,v,!1),r(this,p,!1),o(this,m).setAttribute("show",!1),o(this,f).setAttribute("show",t),browser.runtime.sendMessage({method:"abortTranslation",message:t})}function G(){r(this,v,!1),o(this,m).setAttribute("show",!1),browser.runtime.sendMessage({method:"finishTranslation",result:{sourceLanguage:o(this,u),targetLanguage:o(this,g)}})}function Q(t,s){for(const i of t)if("STYLE"!==i.nodeName&&"META"!==i.nodeName&&"LINK"!==i.nodeName&&"SCRIPT"!==i.nodeName&&"svg"!==i.nodeName&&(e(i)||n(i))&&i.clientTop<window.innerHeight)s.push(i);else{const t=i.children;if(!t||0===t.length)continue;Q(i.children,s)}}new class{constructor(){s(this,H),s(this,N),s(this,O),s(this,I),s(this,B),s(this,x),s(this,_),s(this,A),s(this,W),s(this,E),s(this,M),s(this,k),s(this,S),s(this,L),s(this,T),s(this,y),i(this,d,{writable:!0,value:1}),i(this,u,{writable:!0,value:void 0}),i(this,g,{writable:!0,value:void 0}),i(this,h,{writable:!0,value:{}}),i(this,w,{writable:!0,value:{}}),i(this,m,{writable:!0,value:void 0}),i(this,f,{writable:!0,value:void 0}),i(this,v,{writable:!0,value:!1}),i(this,b,{writable:!0,value:!1}),i(this,p,{writable:!0,value:!1}),c(this,y,C).call(this)}}})();
//# sourceMappingURL=content.js.map