{"version":3,"file":"translate_selection.js","mappings":"mBAGEA,QAAQC,QAAQC,UAAUC,aAAY,CAACC,EAASC,EAAQC,KACtD,GAAKF,EAGL,OAAQA,EAAQG,QACd,IAAK,0BAA2B,CAC9B,MAEMC,EAFYC,OAAOC,eACGC,WAAW,GACPC,wBAE1BC,EAAIL,EAAcM,KAAOL,OAAOM,QAChCC,EAAIR,EAAcS,OAASR,OAAOS,QAAU,GAE5CC,EAwFd,WACE,MAAMC,EAAK,oBACLC,EAAUC,SAASC,eAAeH,GACxC,GAAIC,EACF,OAAOA,EAAQG,aAGnB,CA/FyBC,GACXJ,EAoCd,SAAuBF,GACrB,MAAMC,EAAK,oBACX,CACE,MAAMC,EAAUC,SAASC,eAAeH,GACpCC,GACFA,EAAQK,QAEZ,CAEAJ,SAASK,KAAKC,mBACZ,YACC,0BAAyBR,2BAE5B,MAAMC,EAAUC,SAASC,eAAeH,GACxCC,EAAQQ,aAAa,WAAYC,KAAKC,UAAUZ,IAEhD,MAAMa,EAAWC,IACXA,EAAMC,OAAOC,QAAQf,KAGzBC,EAAQK,SACRJ,SAASc,oBAAoB,QAASJ,GAAQ,EA2BhD,OAxBAV,SAASe,iBAAiB,QAASL,GACnCX,EAAQgB,iBAAiB,SAAS,KAChChB,EAAQK,SACRJ,SAASc,oBAAoB,QAASJ,EAAQ,IAEhDX,EAAQgB,iBAAiB,UAAUC,UACjC,GAAKL,EAAMM,OAAX,CAIA,UACQvC,QAAQwC,QAAQC,MAAMC,IAAI,CAC9BC,4BAAwBC,EACxBC,uBAAwBZ,EAAMM,OAAOM,wBAIzC,CAFE,MAAOC,GACPzB,EAAQQ,aAAa,QAASiB,EAAMC,QACtC,CACA/C,QAAQC,QAAQ+C,YAAY,CAC1BzC,OAAQ,qBACR0C,mBAAeL,GAZjB,CAaE,IAGGvB,CACT,CArFwB6B,CAAc/B,GAAY,CAAEN,IAAGG,MAC/CK,EAAQQ,aAAa,WAAW,GAEhCvB,IACA,KACF,CACA,IAAK,2BAA4B,CAC/B,MAAM6C,EAAS/C,EAAQ+C,OACjB9B,EAAUC,SAASC,eAAe,qBACxC,GAAIF,EAAS,CACX,GAAI8B,EAAOA,QAAUA,EAAOA,OAAOC,MAAO,CACxC,MAAMC,EAAOF,EAAOA,OAAOC,MAAME,KAAKC,GAAMA,EAAEF,OAAMG,KAAK,MACzDnC,EAAQQ,aAAa,SAAW,GAAEwB,KAClChC,EAAQQ,aAAa,OAAS,GAAEzB,EAAQqD,gBAAkB,KAC5D,MACE,GAAIN,EAAOL,MAAO,CAChB,MAAMC,EAAU/C,QAAQ0D,KAAKC,WAC3B,+BAEFtC,EAAQQ,aAAa,QAASkB,EAChC,KAAO,CACL,MAAMA,EAAU/C,QAAQ0D,KAAKC,WAC3B,+BAEFtC,EAAQQ,aAAa,QAASkB,EAChC,CAEF1B,EAAQQ,aAAa,WAAW,EAClC,CACAvB,IACA,KACF,EAAC,G","sources":["webpack://webtranslator/./src/content/translate_selection.js"],"sourcesContent":["\"use strict\";\n\nfunction setup() {\n  browser.runtime.onMessage.addListener((request, sender, sendResponse) => {\n    if (!request) {\n      return;\n    }\n    switch (request.method) {\n      case \"startTranslateSelection\": {\n        const selection = window.getSelection();\n        const textRange = selection.getRangeAt(0);\n        const selectionRect = textRange.getBoundingClientRect();\n\n        const x = selectionRect.left + window.scrollX;\n        const y = selectionRect.bottom + window.scrollY + 30;\n\n        const position = getExistingPopoverPosition();\n        const popover = createPopover(position || { x, y });\n        popover.setAttribute(\"loading\", true);\n\n        sendResponse();\n        break;\n      }\n      case \"finishTranslateSelection\": {\n        const result = request.result;\n        const popover = document.getElementById(\"translate-popover\");\n        if (popover) {\n          if (result.result && result.result.texts) {\n            const text = result.result.texts.map((t) => t.text).join(\"\\n\");\n            popover.setAttribute(\"result\", `${text}`);\n            popover.setAttribute(\"lang\", `${request.targetLanguage || \"\"}`);\n          } else {\n            if (result.error) {\n              const message = browser.i18n.getMessage(\n                \"error_message_generic_error\"\n              );\n              popover.setAttribute(\"error\", message);\n            } else {\n              const message = browser.i18n.getMessage(\n                \"error_message_generic_error\"\n              );\n              popover.setAttribute(\"error\", message);\n            }\n          }\n          popover.setAttribute(\"loading\", false);\n        }\n        sendResponse();\n        break;\n      }\n    }\n  });\n}\n\nfunction createPopover(position) {\n  const id = \"translate-popover\";\n  {\n    const popover = document.getElementById(id);\n    if (popover) {\n      popover.remove();\n    }\n  }\n\n  document.body.insertAdjacentHTML(\n    \"beforeend\",\n    `<translate-popover id=\"${id}\"></translate-popover>`\n  );\n  const popover = document.getElementById(id);\n  popover.setAttribute(\"position\", JSON.stringify(position));\n\n  const onClick = (event) => {\n    if (event.target.closest(id)) {\n      return;\n    }\n    popover.remove();\n    document.removeEventListener(\"click\", onClick);\n  };\n\n  document.addEventListener(\"click\", onClick);\n  popover.addEventListener(\"close\", () => {\n    popover.remove();\n    document.removeEventListener(\"click\", onClick);\n  });\n  popover.addEventListener(\"change\", async (event) => {\n    if (!event.detail) {\n      return;\n    }\n\n    try {\n      await browser.storage.local.set({\n        selectedSourceLanguage: undefined,\n        selectedTargetLanguage: event.detail.selectedTargetLanguage,\n      });\n    } catch (error) {\n      popover.setAttribute(\"error\", error.message);\n    }\n    browser.runtime.sendMessage({\n      method: \"translateSelection\",\n      selectionText: undefined,\n    });\n  });\n\n  return popover;\n}\n\nfunction getExistingPopoverPosition() {\n  const id = \"translate-popover\";\n  const popover = document.getElementById(id);\n  if (popover) {\n    return popover.getPosition();\n  }\n  return undefined;\n}\n\nsetup();\n"],"names":["browser","runtime","onMessage","addListener","request","sender","sendResponse","method","selectionRect","window","getSelection","getRangeAt","getBoundingClientRect","x","left","scrollX","y","bottom","scrollY","position","id","popover","document","getElementById","getPosition","getExistingPopoverPosition","remove","body","insertAdjacentHTML","setAttribute","JSON","stringify","onClick","event","target","closest","removeEventListener","addEventListener","async","detail","storage","local","set","selectedSourceLanguage","undefined","selectedTargetLanguage","error","message","sendMessage","selectionText","createPopover","result","texts","text","map","t","join","targetLanguage","i18n","getMessage"],"sourceRoot":""}